# Z80-Emulator in Python

Mit diesem Emulator lassen sich die Programmabläufe von Z80-Programmen Schritt-für-Schritt analysieren.
Das Projekt ist noch im frühen alpha-Satdium, da bei weitem nicht alle Opcodes hinterlegt sind.
Es reicht für die mitgelieferte Binärdatei, die vollständig ausgeführt wird.

Startpunkt für eigene Anpassungen ist die Datei emu.py, die in diesem Fall den Speicher und die CPU instanziiert.

Ein Beispielaufruf von emu.py:

    Welcome to Z80-Emulator!
    report: load 133 bytes at 0x0100
    0100: 06 04 7E FE  ED 28 2E CB  
    0108: AF FE DD 28  09 7E FE CB  
    0110: 20 2F 06 02  18 53 23 7E  
    0118: FE CB 28 4D  04 E6 F8 FE  
    0120: 
    A  -Flags-- B C  D E  H L  M  IX   IY   I
    00 .....v.. 0000 0000 00C9 .. 0000 0000 00
    A' -Flags'- B'C' D'E' H'L' M' SP   PC   R
    FF SZ5H3PNC FFFF FFFF FFFF .. FFFE 0100 00
    cmd: 006h   LD B, 004h     A=00 F=.....v.. BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0102  R=01
    cmd: 07Eh   LD A, (HL)     A=00 F=.....v.. BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0103  R=02
    cmd: 0FEh   CP 0EDh        A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0105  R=03
    cmd: 028h   JR Z, +46      A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0107  R=04
    cmd: 0CBh   RES 5,A        A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0109  R=05
    cmd: 0FEh   CP 0DDh        A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=010B  R=06
    cmd: 028h   JR Z, +9       A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=010D  R=07
    cmd: 07Eh   LD A, (HL)     A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=010E  R=08
    cmd: 0FEh   CP 0CBh        A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0110  R=09
    cmd: 020h   JR NZ, +47     A=00 F=.....vNC BC=0400 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0141  R=0A
    cmd: 006h   LD B, 003h     A=00 F=.....vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0143  R=0B
    cmd: 07Eh   LD A, (HL)     A=00 F=.....vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0144  R=0C
    cmd: 0FEh   CP 0CDh        A=00 F=.....vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0146  R=0D
    cmd: 028h   JR Z, +31      A=00 F=.....vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0148  R=0E
    cmd: 0FEh   CP 0C3h        A=00 F=.....vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=014A  R=0F
    cmd: 028h   JR Z, +27      A=00 F=.....vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=014C  R=10
    cmd: 0E6h   AND 0E7h       A=00 F=.Z.H.P.. BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=014E  R=11
    cmd: 0FEh   CP 022h        A=00 F=S..H.vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0150  R=12
    cmd: 028h   JR Z, +23      A=00 F=S..H.vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0152  R=13
    cmd: 07Eh   LD A, (HL)     A=00 F=S..H.vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0153  R=14
    cmd: 0E6h   AND 0CFh       A=00 F=.Z.H.P.. BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0155  R=15
    cmd: 0FEh   CP 001h        A=00 F=S..H.vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0157  R=16
    cmd: 028h   JR Z, +16      A=00 F=S..H.vNC BC=0300 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0159  R=17
    cmd: 005h   DEC B          A=00 F=...H.vNC BC=0200 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=015A  R=18
    cmd: 0E6h   AND 0C7h       A=00 F=.Z.H.P.. BC=0200 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=015C  R=19
    cmd: 028h   JR Z, +32      A=00 F=.Z.H.P.. BC=0200 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=017E  R=1A
    cmd: 07Eh   LD A, (HL)     A=00 F=.Z.H.P.. BC=0200 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=017F  R=1B
    cmd: 0FEh   CP 009h        A=00 F=S..H.vNC BC=0200 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0181  R=1C
    cmd: 038h   JR C, -9       A=00 F=S..H.vNC BC=0200 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=017A  R=1D
    cmd: 005h   DEC B          A=00 F=...H.vNC BC=0100 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=017B  R=1E
    cmd: 078h   LD A, B        A=01 F=...H.vNC BC=0100 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=017C  R=1F
    cmd: 018h   JR -21         A=01 F=...H.vNC BC=0100 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=0169  R=20
    cmd: 0A7h   AND A          A=01 F=...H.P.. BC=0100 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=FFFE PC=016A  R=21
    cmd: 0C9h   RET            A=01 F=...H.P.. BC=0100 DE=0000 HL=00C9  IX=0000 IY=0000  I=00 A'=FF F'=SZ5H3PNC BC'=FFFF DE'=FFFF HL'=FFFF  SP=0001 PC=0000  R=22
    program finish after 34 steps!, test value: C9  result: 1

## bekannte Schwachstellen
- sehr unvollständige Emulation (viele Opcodes fehlen noch)
- IN/OUT-Befehle werden nicht emuliert
- Half-Carry-Flag nur unvollständig implementiert
